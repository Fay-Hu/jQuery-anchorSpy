!function($){$.fn.anchorSpy=function(options){if(void 0===this)return"error";var $this=this,settings=$.extend({margin:50,speed:1e3,next:!1,prev:!1,active_class:"active",active_parent:!0,time_interval:150},options),my_debounce=function(func,wait){var timeout;return function(){var context=this,args=arguments,later=function(){timeout=null,func.apply(context,args)};return timeout||(timeout=setTimeout(later,wait)),timeout}},nowActive="",reActive=function(name){return name===nowActive||void 0===name?!1:(settings.active_parent?($this.find("a").parent().removeClass(settings.active_class),$this.find("a[href=#"+name+"]").parent().addClass(settings.active_class)):($this.find("a").removeClass(settings.active_class),$this.find("a[href=#"+name+"]").addClass(settings.active_class)),void(nowActive=name))};return $this.reload=function(){var $a_list=$this.find("a"),a_list_checked=[],blocks={};if($.each($a_list,function(i,j){var $a=$(j),$aName=[],href=$a.attr("href"),name=href.substr(1);"#"===href.substr(0,1)&&($aName=$("a[name="+name+"], #"+name),$aName.length&&(blocks[name]={top:$aName.offset().top,bottom:$aName.offset().top+$aName.parent().height()+settings.margin},a_list_checked.push(j)))}),Object.keys(blocks).length>0){var ScrollTo=function(name){return void 0===name?!1:void $("html, body").stop().animate({scrollTop:blocks[name].top-settings.margin},settings.speed)};if($this.next=function(){var last=nowActive,keys=Object.keys(blocks),i=""===last?-1:keys.indexOf(last);if(-1!==i||""===last){var name=keys[i+1];reActive(name),ScrollTo(name)}return!1},$this.prev=function(){var last=nowActive;if(""===last)return!1;var keys=Object.keys(blocks),i=keys.indexOf(last);if(-1!==i&&i>0){var name=keys[i-1];reActive(name),ScrollTo(name)}return!1},settings.prev){var $prev=$(settings.prev);Object.keys($prev).length>0&&$prev.off("click").on("click",$this.prev)}if(settings.next){var $next=$(settings.next);Object.keys($next).length>0&&$next.off("click").on("click",$this.next)}var actionOnScroll=my_debounce(function(){var wst=$(window).scrollTop()+settings.margin+1;$.each(blocks,function(n,v){v.top<=wst&&v.bottom>wst&&reActive(n)})},settings.time_interval);$(document).scroll(actionOnScroll),$(document).on({touchmove:actionOnScroll()}),$(a_list_checked).off("click").click(function(){var name=$(this).attr("href");return name=name.substr(1),blocks[name]?(ScrollTo(name),!1):void 0})}},$this.reload(),$(window).resize(function(){$this.reload()}),$this}}(jQuery);